option_settings:
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "npm start"
    ProxyServer: nginx
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: build/static
  aws:elbv2:loadbalancer:
    IdleTimeout: 4000

commands:
  01_backup_nginx:
    command: "cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup || true"
    ignoreErrors: true
  02_validate_config:
    command: "nginx -t || echo 'Nginx config validation failed but continuing'"
    ignoreErrors: true